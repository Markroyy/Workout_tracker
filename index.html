
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTracker Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #0c4a6e 50%, #1e293b 75%, #0f172a 100%);
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: white;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.4);
        }

        .logo-text h1 {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffffff, #67e8f9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-text p {
            color: #67e8f9;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .nav-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 14px 24px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #67e8f9;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .nav-btn:hover {
            background: rgba(6, 182, 212, 0.3);
            color: white;
            transform: translateY(-2px);
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, #0891b2, #3b82f6);
            color: white;
            border-color: transparent;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #0891b2, #3b82f6);
            border: none;
            border-radius: 18px;
            padding: 30px;
            color: white;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.4s ease;
            min-height: 120px;
            box-shadow: 0 8px 24px rgba(8, 145, 178, 0.4);
        }

        .action-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 36px rgba(8, 145, 178, 0.6);
        }

        .action-btn.blue {
            background: linear-gradient(135deg, #1d4ed8, #7c3aed);
        }

        .action-btn.green {
            background: linear-gradient(135deg, #059669, #10b981);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #0891b2, #3b82f6);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(8, 145, 178, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-icon {
            font-size: 6rem;
            color: #67e8f9;
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #9ca3af;
            font-size: 1.05rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background: linear-gradient(135deg, #1e293b 0%, #0c4a6e 100%);
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-content.large {
            max-width: 900px;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            color: #67e8f9;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #67e8f9;
            font-weight: 500;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            font-size: 1rem;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.2);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .search-results.active {
            display: block;
        }

        .search-result-item {
            padding: 14px 15px;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.2s ease;
            min-height: 48px;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .search-result-item:active {
            background: rgba(255, 255, 255, 0.15);
        }

        .selected-exercises {
            min-height: 60px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .selected-exercise-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .selected-exercise-item:last-child {
            margin-bottom: 0;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .selected-exercise-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .selected-exercise-details {
            font-size: 0.85rem;
            color: #67e8f9;
        }

        .sets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sets-label {
            font-size: 0.9rem;
            color: #67e8f9;
            font-weight: 500;
        }

        .add-set-btn {
            background: rgba(8, 145, 178, 0.3);
            border: 1px solid rgba(8, 145, 178, 0.5);
            color: white;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            min-height: 36px;
            transition: all 0.3s ease;
        }

        .add-set-btn:hover {
            background: rgba(8, 145, 178, 0.5);
        }

        .set-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .set-item.completed {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .set-label {
            font-size: 0.8rem;
            color: #9ca3af;
            width: 40px;
        }

        .set-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 10px;
            color: white;
            font-size: 0.9rem;
            width: 70px;
            text-align: center;
            min-height: 40px;
        }

        .set-input:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.2);
        }

        .set-checkbox {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #10b981;
        }

        .remove-btn {
            background: #ef4444;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            min-height: 36px;
            min-width: 36px;
            transition: all 0.3s ease;
        }

        .remove-btn:hover {
            background: #dc2626;
        }

        .notes-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 60px;
        }

        .saved-workout {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
        }

        .saved-workout:hover {
            transform: translateY(-4px);
            border-color: rgba(8, 145, 178, 0.5);
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .workout-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .workout-description {
            color: #67e8f9;
            font-size: 0.9rem;
        }

        .workout-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .split-exercise-list {
            margin-top: 20px;
            display: grid;
            gap: 12px;
        }

        .split-exercise-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .split-exercise-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(8, 145, 178, 0.4);
        }

        .split-exercise-name {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 5px;
        }

        .split-exercise-details {
            font-size: 0.85rem;
            color: #67e8f9;
        }

        .split-exercise-sets {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 5px;
        }

        .progress-btn {
            background: linear-gradient(135deg, #059669, #10b981);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .progress-btn:hover {
            transform: translateY(-2px);
        }

        .workout-stats {
            display: flex;
            gap: 20px;
            font-size: 0.85rem;
            color: #9ca3af;
            flex-wrap: wrap;
        }

        .last-workout-reference {
            background: rgba(6, 182, 212, 0.1);
            border: 1px solid rgba(6, 182, 212, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .last-workout-header {
            font-size: 0.85rem;
            color: #67e8f9;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .last-workout-sets {
            font-size: 0.8rem;
            color: #9ca3af;
            line-height: 1.6;
        }

        .last-workout-sets div {
            display: flex;
            gap: 8px;
            margin-bottom: 4px;
        }

        .last-workout-badge {
            background: rgba(6, 182, 212, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #67e8f9;
        }

        .copy-last-btn {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid rgba(6, 182, 212, 0.4);
            color: #67e8f9;
            padding: 4px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s ease;
            margin-left: auto;
        }

        .copy-last-btn:hover {
            background: rgba(6, 182, 212, 0.3);
            border-color: rgba(6, 182, 212, 0.6);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .chart-canvas {
            width: 100%;
            height: 350px;
        }

        .no-data-message {
            text-align: center;
            padding: 40px;
            color: #9ca3af;
        }

        @media (max-width: 768px) {
            .container { padding: 12px; }
            .header { padding: 16px; flex-direction: column; text-align: center; }
            .logo-icon { width: 48px; height: 48px; font-size: 22px; }
            .logo-text h1 { font-size: 1.5rem; }
            .logo-text p { font-size: 0.85rem; }
            
            .nav-bar { 
                flex-wrap: nowrap; 
                overflow-x: auto; 
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }
            .nav-bar::-webkit-scrollbar { display: none; }
            .nav-btn { 
                flex: 0 0 auto; 
                padding: 12px 20px; 
                font-size: 0.9rem;
                white-space: nowrap;
            }
            
            .card { padding: 20px; }
            .actions-grid { grid-template-columns: 1fr; gap: 15px; }
            .action-btn { padding: 25px; min-height: 100px; font-size: 1rem; }
            
            .modal-content { 
                margin: 0; 
                width: 100%; 
                height: 100vh; 
                max-width: none; 
                max-height: 100vh;
                border-radius: 0; 
            }
            .modal-header, .modal-body, .modal-footer { padding: 16px; }
            
            .modal-close {
                width: 44px;
                height: 44px;
                font-size: 1.8rem;
            }
            
            .workout-header { flex-direction: column; align-items: stretch; }
            .workout-actions { 
                flex-direction: column; 
                width: 100%;
            }
            .workout-actions .btn { width: 100%; }
            
            .split-exercise-item { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 12px; 
            }
            .progress-btn { 
                width: 100%; 
                justify-content: center;
                padding: 10px 16px;
            }
            
            .btn, .btn-primary, .btn-secondary, .btn-danger {
                padding: 14px 20px;
                font-size: 1rem;
                min-height: 48px;
            }
            
            .set-item {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .set-input {
                min-width: 70px;
                padding: 8px 10px;
                font-size: 1rem;
            }
            
            .set-checkbox {
                width: 24px;
                height: 24px;
            }
            
            .form-input, .form-textarea {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 14px 16px;
            }
            
            .chart-canvas {
                height: 280px;
            }
            
            .chart-container {
                padding: 15px;
                margin-top: 15px;
            }
            
            .selected-exercise-item {
                padding: 16px;
                margin-bottom: 12px;
            }
            
            .split-exercise-list {
                gap: 10px;
            }
            
            .empty-state {
                padding: 60px 20px;
            }
            
            .empty-icon {
                font-size: 4rem;
            }
            
            .workout-stats {
                flex-direction: column;
                gap: 8px;
            }
            
            .last-workout-reference {
                padding: 10px;
            }
            
            .last-workout-header {
                flex-wrap: wrap;
                font-size: 0.8rem;
            }
            
            .copy-last-btn {
                margin-left: 0;
                margin-top: 4px;
                padding: 6px 12px;
                font-size: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .logo-text h1 { font-size: 1.3rem; }
            .action-btn { font-size: 0.95rem; padding: 20px; }
            .modal-header h2 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-icon">üí™</div>
            <div class="logo-text">
                <h1>FitTracker Pro</h1>
                <p>Your fitness journey starts here</p>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-btn active" onclick="app.showPage('dashboard', this)">üìä Dashboard</div>
            <div class="nav-btn" onclick="app.showPage('workouts', this)">üí™ My Splits</div>
            <div class="nav-btn" onclick="app.showPage('progress', this)">üìà Progress</div>
        </div>

        <!-- Dashboard Page -->
        <div class="page active" id="dashboard">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Quick Actions</h2>
                <div class="actions-grid">
                    <button class="action-btn" onclick="app.startQuickWorkout()">
                        üèÉ‚Äç‚ôÇÔ∏è Start Workout
                    </button>
                    <button class="action-btn green" onclick="app.showPage('workouts')">
                        üí™ My Splits
                    </button>
                    <button class="action-btn blue" onclick="app.showPage('progress')">
                        üìà View Progress
                    </button>
                </div>
            </div>
        </div>

        <!-- Workouts Page -->
        <div class="page" id="workouts">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <h2 style="margin: 0;">My Workout Splits</h2>
                    <button class="btn btn-primary" onclick="app.createWorkout()">
                        ‚ûï Create New Split
                    </button>
                </div>
                
                <div id="savedWorkouts"></div>
                
                <div class="empty-state" id="emptyWorkoutsState" style="display: none;">
                    <div class="empty-icon">üìã</div>
                    <h3>No workout splits yet</h3>
                    <p>Create your first workout split to get started!</p>
                    <button class="btn btn-primary" onclick="app.createWorkout()" style="margin-top: 15px;">
                        ‚ûï Create Your First Split
                    </button>
                </div>
            </div>
        </div>

        <!-- Progress Page -->
        <div class="page" id="progress">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Your Progress</h2>
                <div id="progressContent">
                    <div class="no-data-message">
                        <div class="empty-icon">üìà</div>
                        <h3>No workout history yet</h3>
                        <p>Complete some workouts to see your progress!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Workout Creator Modal -->
    <div id="workoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Create New Workout Split</h2>
                <button class="modal-close" onclick="app.closeModal('workoutModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="form-group">
                    <label>Split Name</label>
                    <input type="text" id="workoutName" placeholder="e.g., Push Day, Leg Day" class="form-input" maxlength="100">
                </div>
                
                <div class="form-group">
                    <label>Description (Optional)</label>
                    <textarea id="workoutDescription" placeholder="Brief description..." class="form-textarea" maxlength="500"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Add Exercises</label>
                    <div style="position: relative;">
                        <input type="text" id="exerciseSearch" placeholder="Search exercises..." class="form-input" autocomplete="off">
                        <div id="searchResults" class="search-results"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Selected Exercises</label>
                    <div id="selectedExercises" class="selected-exercises">
                        <p style="color: #9ca3af;">No exercises selected yet</p>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('workoutModal')">Cancel</button>
                <button class="btn btn-primary" onclick="app.saveWorkout()">Save Split</button>
            </div>
        </div>
    </div>

    <!-- Logging Modal -->
    <div id="loggingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="loggingTitle">Log Workout</h2>
                <button class="modal-close" onclick="app.closeModal('loggingModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="loggingExercises"></div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('loggingModal')">Cancel</button>
                <button class="btn btn-primary" onclick="app.completeWorkout()">Complete Workout</button>
            </div>
        </div>
    </div>

    <!-- Progress Modal -->
    <div id="progressModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="progressTitle">Exercise Progress</h2>
                <button class="modal-close" onclick="app.closeModal('progressModal')">&times;</button>
            </div>
            
            <div class="modal-body">
                <div id="chartContent"></div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal('progressModal')">Close</button>
            </div>
        </div>
    </div>

    <script>
        const app = (function() {
            'use strict';

            const EXERCISES = [
                // Chest Exercises
                {name: "Barbell Bench Press", muscle: "Chest", equipment: "Barbell"},
                {name: "Incline Barbell Bench Press", muscle: "Chest", equipment: "Barbell"},
                {name: "Decline Barbell Bench Press", muscle: "Chest", equipment: "Barbell"},
                {name: "Dumbbell Bench Press", muscle: "Chest", equipment: "Dumbbells"},
                {name: "Incline Dumbbell Press", muscle: "Chest", equipment: "Dumbbells"},
                {name: "Decline Dumbbell Press", muscle: "Chest", equipment: "Dumbbells"},
                {name: "Dumbbell Flyes", muscle: "Chest", equipment: "Dumbbells"},
                {name: "Incline Dumbbell Flyes", muscle: "Chest", equipment: "Dumbbells"},
                {name: "Cable Crossovers", muscle: "Chest", equipment: "Cable"},
                {name: "Low Cable Crossovers", muscle: "Chest", equipment: "Cable"},
                {name: "High Cable Crossovers", muscle: "Chest", equipment: "Cable"},
                {name: "Chest Dips", muscle: "Chest", equipment: "Bodyweight"},
                {name: "Push-ups", muscle: "Chest", equipment: "Bodyweight"},
                {name: "Wide Grip Push-ups", muscle: "Chest", equipment: "Bodyweight"},
                {name: "Diamond Push-ups", muscle: "Chest", equipment: "Bodyweight"},
                {name: "Decline Push-ups", muscle: "Chest", equipment: "Bodyweight"},
                {name: "Pec Deck Machine", muscle: "Chest", equipment: "Machine"},
                {name: "Machine Chest Press", muscle: "Chest", equipment: "Machine"},
                {name: "Landmine Press", muscle: "Chest", equipment: "Barbell"},
                {name: "Svend Press", muscle: "Chest", equipment: "Dumbbells"},

                // Back Exercises
                {name: "Conventional Deadlift", muscle: "Back", equipment: "Barbell"},
                {name: "Romanian Deadlift", muscle: "Back", equipment: "Barbell"},
                {name: "Sumo Deadlift", muscle: "Back", equipment: "Barbell"},
                {name: "Trap Bar Deadlift", muscle: "Back", equipment: "Trap Bar"},
                {name: "Pull-ups", muscle: "Back", equipment: "Bodyweight"},
                {name: "Chin-ups", muscle: "Back", equipment: "Bodyweight"},
                {name: "Wide Grip Pull-ups", muscle: "Back", equipment: "Bodyweight"},
                {name: "Neutral Grip Pull-ups", muscle: "Back", equipment: "Bodyweight"},
                {name: "Weighted Pull-ups", muscle: "Back", equipment: "Bodyweight"},
                {name: "Lat Pulldowns", muscle: "Back", equipment: "Cable"},
                {name: "Wide Grip Lat Pulldowns", muscle: "Back", equipment: "Cable"},
                {name: "Close Grip Lat Pulldowns", muscle: "Back", equipment: "Cable"},
                {name: "Bent Over Barbell Rows", muscle: "Back", equipment: "Barbell"},
                {name: "Pendlay Rows", muscle: "Back", equipment: "Barbell"},
                {name: "T-Bar Rows", muscle: "Back", equipment: "T-Bar"},
                {name: "Single Arm Dumbbell Rows", muscle: "Back", equipment: "Dumbbells"},
                {name: "Two Arm Dumbbell Rows", muscle: "Back", equipment: "Dumbbells"},
                {name: "Chest Supported Rows", muscle: "Back", equipment: "Dumbbells"},
                {name: "Seated Cable Rows", muscle: "Back", equipment: "Cable"},
                {name: "Single Arm Cable Rows", muscle: "Back", equipment: "Cable"},
                {name: "Face Pulls", muscle: "Back", equipment: "Cable"},
                {name: "Reverse Flyes", muscle: "Back", equipment: "Dumbbells"},
                {name: "Machine Rows", muscle: "Back", equipment: "Machine"},
                {name: "Inverted Rows", muscle: "Back", equipment: "Bodyweight"},
                {name: "Straight Arm Pulldowns", muscle: "Back", equipment: "Cable"},
                {name: "Rack Pulls", muscle: "Back", equipment: "Barbell"},
                {name: "Meadows Rows", muscle: "Back", equipment: "Barbell"},
                {name: "Seal Rows", muscle: "Back", equipment: "Barbell"},

                // Leg Exercises (Quads)
                {name: "Barbell Back Squat", muscle: "Legs", equipment: "Barbell"},
                {name: "Barbell Front Squat", muscle: "Legs", equipment: "Barbell"},
                {name: "High Bar Squat", muscle: "Legs", equipment: "Barbell"},
                {name: "Low Bar Squat", muscle: "Legs", equipment: "Barbell"},
                {name: "Goblet Squat", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Dumbbell Squat", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Hack Squat", muscle: "Legs", equipment: "Machine"},
                {name: "Leg Press", muscle: "Legs", equipment: "Machine"},
                {name: "Leg Extensions", muscle: "Legs", equipment: "Machine"},
                {name: "Bulgarian Split Squats", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Walking Lunges", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Reverse Lunges", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Forward Lunges", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Lateral Lunges", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Step-ups", muscle: "Legs", equipment: "Dumbbells"},
                {name: "Pistol Squats", muscle: "Legs", equipment: "Bodyweight"},
                {name: "Jump Squats", muscle: "Legs", equipment: "Bodyweight"},
                {name: "Sissy Squats", muscle: "Legs", equipment: "Bodyweight"},
                {name: "Wall Sits", muscle: "Legs", equipment: "Bodyweight"},

                // Leg Exercises (Hamstrings & Glutes)
                {name: "Romanian Deadlifts", muscle: "Legs", equipment: "Barbell"},
                {name: "Stiff Leg Deadlifts", muscle: "Legs", equipment: "Barbell"},
                {name: "Good Mornings", muscle: "Legs", equipment: "Barbell"},
                {name: "Lying Leg Curls", muscle: "Legs", equipment: "Machine"},
                {name: "Seated Leg Curls", muscle: "Legs", equipment: "Machine"},
                {name: "Standing Leg Curls", muscle: "Legs", equipment: "Machine"},
                {name: "Nordic Curls", muscle: "Legs", equipment: "Bodyweight"},
                {name: "Glute Ham Raises", muscle: "Legs", equipment: "Machine"},
                {name: "Hip Thrusts", muscle: "Legs", equipment: "Barbell"},
                {name: "Barbell Glute Bridge", muscle: "Legs", equipment: "Barbell"},
                {name: "Single Leg Glute Bridge", muscle: "Legs", equipment: "Bodyweight"},
                {name: "Cable Pull Throughs", muscle: "Legs", equipment: "Cable"},
                {name: "Kickbacks", muscle: "Legs", equipment: "Cable"},
                {name: "Reverse Hyperextensions", muscle: "Legs", equipment: "Machine"},

                // Calves
                {name: "Standing Calf Raises", muscle: "Calves", equipment: "Machine"},
                {name: "Seated Calf Raises", muscle: "Calves", equipment: "Machine"},
                {name: "Calf Press on Leg Press", muscle: "Calves", equipment: "Machine"},
                {name: "Single Leg Calf Raises", muscle: "Calves", equipment: "Bodyweight"},
                {name: "Donkey Calf Raises", muscle: "Calves", equipment: "Machine"},

                // Shoulder Exercises
                {name: "Barbell Overhead Press", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Seated Barbell Press", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Standing Military Press", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Push Press", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Behind the Neck Press", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Dumbbell Shoulder Press", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Seated Dumbbell Press", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Arnold Press", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Lateral Raises", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Cable Lateral Raises", muscle: "Shoulders", equipment: "Cable"},
                {name: "Machine Lateral Raises", muscle: "Shoulders", equipment: "Machine"},
                {name: "Front Raises", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Barbell Front Raises", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Plate Front Raises", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Rear Delt Flyes", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Bent Over Lateral Raises", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Reverse Pec Deck", muscle: "Shoulders", equipment: "Machine"},
                {name: "Face Pulls", muscle: "Shoulders", equipment: "Cable"},
                {name: "Upright Rows", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Cable Upright Rows", muscle: "Shoulders", equipment: "Cable"},
                {name: "Barbell Shrugs", muscle: "Shoulders", equipment: "Barbell"},
                {name: "Dumbbell Shrugs", muscle: "Shoulders", equipment: "Dumbbells"},
                {name: "Cable Shrugs", muscle: "Shoulders", equipment: "Cable"},
                {name: "Pike Push-ups", muscle: "Shoulders", equipment: "Bodyweight"},
                {name: "Handstand Push-ups", muscle: "Shoulders", equipment: "Bodyweight"},

                // Biceps
                {name: "Barbell Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "EZ Bar Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "Close Grip EZ Bar Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "Wide Grip Barbell Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "Dumbbell Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Alternating Dumbbell Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Hammer Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Cross Body Hammer Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Incline Dumbbell Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Concentration Curls", muscle: "Biceps", equipment: "Dumbbells"},
                {name: "Preacher Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "Machine Preacher Curls", muscle: "Biceps", equipment: "Machine"},
                {name: "Cable Curls", muscle: "Biceps", equipment: "Cable"},
                {name: "High Cable Curls", muscle: "Biceps", equipment: "Cable"},
                {name: "Spider Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "Drag Curls", muscle: "Biceps", equipment: "Barbell"},
                {name: "21s", muscle: "Biceps", equipment: "Barbell"},
                {name: "Zottman Curls", muscle: "Biceps", equipment: "Dumbbells"},

                // Triceps
                {name: "Close Grip Bench Press", muscle: "Triceps", equipment: "Barbell"},
                {name: "Dumbbell Tricep Press", muscle: "Triceps", equipment: "Dumbbells"},
                {name: "Overhead Tricep Extension", muscle: "Triceps", equipment: "Dumbbells"},
                {name: "Cable Overhead Extension", muscle: "Triceps", equipment: "Cable"},
                {name: "Skull Crushers", muscle: "Triceps", equipment: "Barbell"},
                {name: "EZ Bar Skull Crushers", muscle: "Triceps", equipment: "Barbell"},
                {name: "Dumbbell Skull Crushers", muscle: "Triceps", equipment: "Dumbbells"},
                {name: "Cable Tricep Pushdowns", muscle: "Triceps", equipment: "Cable"},
                {name: "Rope Tricep Pushdowns", muscle: "Triceps", equipment: "Cable"},
                {name: "Single Arm Pushdowns", muscle: "Triceps", equipment: "Cable"},
                {name: "Reverse Grip Pushdowns", muscle: "Triceps", equipment: "Cable"},
                {name: "Tricep Kickbacks", muscle: "Triceps", equipment: "Dumbbells"},
                {name: "Tricep Dips", muscle: "Triceps", equipment: "Bodyweight"},
                {name: "Bench Dips", muscle: "Triceps", equipment: "Bodyweight"},
                {name: "Diamond Push-ups", muscle: "Triceps", equipment: "Bodyweight"},
                {name: "JM Press", muscle: "Triceps", equipment: "Barbell"},
                {name: "Tate Press", muscle: "Triceps", equipment: "Dumbbells"},

                // Forearms
                {name: "Wrist Curls", muscle: "Forearms", equipment: "Barbell"},
                {name: "Reverse Wrist Curls", muscle: "Forearms", equipment: "Barbell"},
                {name: "Farmer's Walk", muscle: "Forearms", equipment: "Dumbbells"},
                {name: "Plate Pinch", muscle: "Forearms", equipment: "Dumbbells"},
                {name: "Reverse Curls", muscle: "Forearms", equipment: "Barbell"},
                {name: "Hammer Curls", muscle: "Forearms", equipment: "Dumbbells"},

                // Core/Abs
                {name: "Crunches", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Sit-ups", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Decline Sit-ups", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Cable Crunches", muscle: "Abs", equipment: "Cable"},
                {name: "Rope Crunches", muscle: "Abs", equipment: "Cable"},
                {name: "Hanging Leg Raises", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Hanging Knee Raises", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Ab Wheel Rollouts", muscle: "Abs", equipment: "Ab Wheel"},
                {name: "Plank", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Side Plank", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Russian Twists", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Bicycle Crunches", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Mountain Climbers", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Leg Raises", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Flutter Kicks", muscle: "Abs", equipment: "Bodyweight"},
                {name: "V-ups", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Woodchoppers", muscle: "Abs", equipment: "Cable"},
                {name: "Pallof Press", muscle: "Abs", equipment: "Cable"},
                {name: "Dead Bug", muscle: "Abs", equipment: "Bodyweight"},
                {name: "Bird Dog", muscle: "Abs", equipment: "Bodyweight"},

                // Compound/Full Body
                {name: "Power Cleans", muscle: "Full Body", equipment: "Barbell"},
                {name: "Clean and Press", muscle: "Full Body", equipment: "Barbell"},
                {name: "Hang Cleans", muscle: "Full Body", equipment: "Barbell"},
                {name: "Snatch", muscle: "Full Body", equipment: "Barbell"},
                {name: "Thrusters", muscle: "Full Body", equipment: "Barbell"},
                {name: "Burpees", muscle: "Full Body", equipment: "Bodyweight"},
                {name: "Turkish Get-ups", muscle: "Full Body", equipment: "Dumbbells"},
                {name: "Kettlebell Swings", muscle: "Full Body", equipment: "Kettlebell"},
                {name: "Man Makers", muscle: "Full Body", equipment: "Dumbbells"}
            ];

            let workouts = [];
            let history = [];
            let currentExercises = [];
            let editingId = null;
            let activeWorkout = null;
            let startTime = 0;

            function init() {
                workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
                history = JSON.parse(localStorage.getItem('history') || '[]');
                setupEventListeners();
            }

            function setupEventListeners() {
                const searchInput = document.getElementById('exerciseSearch');
                const searchResults = document.getElementById('searchResults');
                
                searchInput.addEventListener('input', (e) => {
                    const query = e.target.value.toLowerCase().trim();
                    if (query.length < 2) {
                        searchResults.classList.remove('active');
                        return;
                    }
                    
                    const filtered = EXERCISES.filter(ex => 
                        ex.name.toLowerCase().includes(query) ||
                        ex.muscle.toLowerCase().includes(query)
                    );
                    
                    if (filtered.length === 0) {
                        searchResults.innerHTML = '<div style="padding: 12px; color: #9ca3af;">No exercises found</div>';
                        searchResults.classList.add('active');
                        return;
                    }
                    
                    searchResults.innerHTML = filtered.slice(0, 5).map(ex => `
                        <div class="search-result-item" onclick="app.addExercise('${ex.name}', '${ex.muscle}', '${ex.equipment}')">
                            <div style="font-weight: 500;">${ex.name}</div>
                            <div style="font-size: 0.85rem; color: #67e8f9;">${ex.muscle} ‚Ä¢ ${ex.equipment}</div>
                        </div>
                    `).join('');
                    searchResults.classList.add('active');
                });

                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#exerciseSearch') && !e.target.closest('#searchResults')) {
                        searchResults.classList.remove('active');
                    }
                });
            }

            function showPage(pageId, element) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                
                document.getElementById(pageId).classList.add('active');
                if (element) element.classList.add('active');
                
                if (pageId === 'workouts') displayWorkouts();
                if (pageId === 'progress') displayProgress();
            }

            function createWorkout() {
                editingId = null;
                currentExercises = [];
                document.getElementById('workoutName').value = '';
                document.getElementById('workoutDescription').value = '';
                document.getElementById('exerciseSearch').value = '';
                document.getElementById('modalTitle').textContent = 'Create New Workout Split';
                updateSelectedExercises();
                document.getElementById('workoutModal').classList.add('active');
            }

            function addExercise(name, muscle, equipment) {
                if (currentExercises.some(ex => ex.name === name)) {
                    alert('Exercise already added');
                    return;
                }
                
                currentExercises.push({
                    name,
                    muscle,
                    equipment,
                    sets: [{reps: '', weight: ''}]
                });
                
                document.getElementById('exerciseSearch').value = '';
                document.getElementById('searchResults').classList.remove('active');
                updateSelectedExercises();
            }

            function updateSelectedExercises() {
                const container = document.getElementById('selectedExercises');
                
                if (currentExercises.length === 0) {
                    container.innerHTML = '<p style="color: #9ca3af;">No exercises selected yet</p>';
                    return;
                }
                
                container.innerHTML = currentExercises.map((ex, exIdx) => `
                    <div class="selected-exercise-item">
                        <div class="exercise-header">
                            <div>
                                <div class="selected-exercise-name">${ex.name}</div>
                                <div class="selected-exercise-details">${ex.muscle} ‚Ä¢ ${ex.equipment}</div>
                            </div>
                            <button class="remove-btn" onclick="app.removeExercise(${exIdx})">Remove</button>
                        </div>
                        
                        <div class="sets-header">
                            <span class="sets-label">Sets</span>
                            <button class="add-set-btn" onclick="app.addSet(${exIdx})">+ Add Set</button>
                        </div>
                        
                        <div>
                            ${ex.sets.map((set, setIdx) => `
                                <div class="set-item">
                                    <span class="set-label">Set ${setIdx + 1}</span>
                                    <input type="number" class="set-input" placeholder="Reps" value="${set.reps}" 
                                           onchange="app.updateSet(${exIdx}, ${setIdx}, 'reps', this.value)" min="0" max="1000">
                                    <span style="color: #9ca3af; font-size: 0.8rem;">reps</span>
                                    ${ex.equipment !== 'Bodyweight' ? `
                                        <input type="number" class="set-input" placeholder="Weight" value="${set.weight}"
                                               onchange="app.updateSet(${exIdx}, ${setIdx}, 'weight', this.value)" min="0" max="10000">
                                        <span style="color: #9ca3af; font-size: 0.8rem;">kg</span>
                                    ` : ''}
                                    <button class="remove-btn" onclick="app.removeSet(${exIdx}, ${setIdx})">√ó</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            function addSet(exIdx) {
                currentExercises[exIdx].sets.push({reps: '', weight: ''});
                updateSelectedExercises();
            }

            function removeSet(exIdx, setIdx) {
                currentExercises[exIdx].sets.splice(setIdx, 1);
                updateSelectedExercises();
            }

            function updateSet(exIdx, setIdx, field, value) {
                currentExercises[exIdx].sets[setIdx][field] = value;
            }

            function removeExercise(exIdx) {
                currentExercises.splice(exIdx, 1);
                updateSelectedExercises();
            }

            function saveWorkout() {
                const name = document.getElementById('workoutName').value.trim();
                const description = document.getElementById('workoutDescription').value.trim();
                
                if (!name) {
                    alert('Please enter a split name');
                    return;
                }
                
                if (currentExercises.length === 0) {
                    alert('Please add at least one exercise');
                    return;
                }
                
                const workout = {
                    id: editingId || Date.now(),
                    name,
                    description,
                    exercises: currentExercises,
                    createdAt: new Date().toISOString()
                };
                
                if (editingId) {
                    const idx = workouts.findIndex(w => w.id === editingId);
                    workouts[idx] = workout;
                } else {
                    workouts.push(workout);
                }
                
                localStorage.setItem('workouts', JSON.stringify(workouts));
                closeModal('workoutModal');
                displayWorkouts();
                alert('Split saved!');
            }

            function displayWorkouts() {
                const container = document.getElementById('savedWorkouts');
                const emptyState = document.getElementById('emptyWorkoutsState');
                
                if (workouts.length === 0) {
                    container.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }
                
                emptyState.style.display = 'none';
                container.innerHTML = workouts.map(w => `
                    <div class="saved-workout">
                        <div class="workout-header">
                            <div>
                                <div class="workout-title">${w.name}</div>
                                ${w.description ? `<div class="workout-description">${w.description}</div>` : ''}
                            </div>
                            <div class="workout-actions">
                                <button class="btn btn-primary btn-small" onclick="app.startWorkout(${w.id})">‚ñ∂ Start</button>
                                <button class="btn btn-secondary btn-small" onclick="app.editWorkout(${w.id})">‚úèÔ∏è Edit</button>
                                <button class="btn btn-danger btn-small" onclick="app.deleteWorkout(${w.id})">üóëÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="split-exercise-list">
                            ${w.exercises.map(ex => {
                                const setsSummary = ex.sets.length > 0 
                                    ? `${ex.sets.length} sets: ${ex.sets.map(s => `${s.reps || '?'} reps${ex.equipment !== 'Bodyweight' ? ` @ ${s.weight || '?'} kg` : ''}`).join(', ')}`
                                    : 'No sets defined';
                                
                                return `
                                    <div class="split-exercise-item">
                                        <div>
                                            <div class="split-exercise-name">${ex.name}</div>
                                            <div class="split-exercise-details">${ex.muscle} ‚Ä¢ ${ex.equipment}</div>
                                            <div class="split-exercise-sets">${setsSummary}</div>
                                        </div>
                                        <button class="progress-btn" onclick="app.showProgress('${ex.name}')">üìä Progress</button>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <div class="workout-stats">
                            <span>üìã ${w.exercises.length} exercises</span>
                            <span>üìÖ Created ${new Date(w.createdAt).toLocaleDateString()}</span>
                        </div>
                    </div>
                `).join('');
            }

            function editWorkout(id) {
                const workout = workouts.find(w => w.id === id);
                if (!workout) return;
                
                editingId = id;
                currentExercises = JSON.parse(JSON.stringify(workout.exercises));
                document.getElementById('workoutName').value = workout.name;
                document.getElementById('workoutDescription').value = workout.description || '';
                document.getElementById('exerciseSearch').value = '';
                document.getElementById('modalTitle').textContent = 'Edit Workout Split';
                updateSelectedExercises();
                document.getElementById('workoutModal').classList.add('active');
            }

            function deleteWorkout(id) {
                if (confirm('Delete this split?')) {
                    workouts = workouts.filter(w => w.id !== id);
                    localStorage.setItem('workouts', JSON.stringify(workouts));
                    displayWorkouts();
                }
            }

            function startWorkout(id) {
                const workout = workouts.find(w => w.id === id);
                if (!workout) return;
                
                activeWorkout = {
                    id: workout.id,
                    name: workout.name,
                    exercises: JSON.parse(JSON.stringify(workout.exercises))
                };
                
                startTime = Date.now();
                renderLogging();
                document.getElementById('loggingModal').classList.add('active');
            }

            function getLastWorkoutData(exerciseName) {
                // Find the most recent completed workout that includes this exercise
                const workoutsWithExercise = history
                    .filter(w => w.exercises.some(ex => ex.name === exerciseName))
                    .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));
                
                if (workoutsWithExercise.length === 0) return null;
                
                const lastWorkout = workoutsWithExercise[0];
                const exercise = lastWorkout.exercises.find(ex => ex.name === exerciseName);
                
                return {
                    date: new Date(lastWorkout.completedAt).toLocaleDateString('en-GB', { 
                        day: 'numeric', 
                        month: 'short', 
                        year: 'numeric' 
                    }),
                    sets: exercise.sets
                };
            }

            function renderLogging() {
                document.getElementById('loggingTitle').textContent = `Log: ${activeWorkout.name}`;
                const container = document.getElementById('loggingExercises');
                
                container.innerHTML = activeWorkout.exercises.map((ex, exIdx) => {
                    const lastWorkout = getLastWorkoutData(ex.name);
                    
                    let lastWorkoutHtml = '';
                    if (lastWorkout) {
                        lastWorkoutHtml = `
                            <div class="last-workout-reference">
                                <div class="last-workout-header">
                                    üìä Last Workout - ${lastWorkout.date}
                                    <button class="copy-last-btn" onclick="app.copyLastWorkout(${exIdx})">üìã Copy</button>
                                </div>
                                <div class="last-workout-sets">
                                    ${lastWorkout.sets.map((set, i) => `
                                        <div>
                                            <span class="last-workout-badge">Set ${i + 1}</span>
                                            <span>${set.reps} reps ${ex.equipment !== 'Bodyweight' ? `@ ${set.weight} kg` : ''}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }
                    
                    return `
                        <div class="selected-exercise-item">
                            <div class="exercise-header">
                                <div>
                                    <div class="selected-exercise-name">${ex.name}</div>
                                    <div class="selected-exercise-details">${ex.muscle} ‚Ä¢ ${ex.equipment}</div>
                                </div>
                                <button class="progress-btn" onclick="app.showProgress('${ex.name}')">üìä</button>
                            </div>
                            
                            ${lastWorkoutHtml}
                            
                            <div class="sets-header">
                                <span class="sets-label">Sets & Reps</span>
                                <button class="add-set-btn" onclick="app.addLogSet(${exIdx})">+ Add</button>
                            </div>
                            
                            <div>
                                ${ex.sets.map((set, setIdx) => `
                                    <div class="set-item ${set.completed ? 'completed' : ''}">
                                        <input type="checkbox" class="set-checkbox" ${set.completed ? 'checked' : ''}
                                               onchange="app.toggleSet(${exIdx}, ${setIdx}, this.checked)">
                                        <span class="set-label">Set ${setIdx + 1}</span>
                                        <input type="number" class="set-input" placeholder="Reps" value="${set.reps || ''}"
                                               onchange="app.updateLogSet(${exIdx}, ${setIdx}, 'reps', this.value)">
                                        <span style="color: #9ca3af; font-size: 0.8rem;">reps</span>
                                        ${ex.equipment !== 'Bodyweight' ? `
                                            <input type="number" class="set-input" placeholder="Weight" value="${set.weight || ''}"
                                                   onchange="app.updateLogSet(${exIdx}, ${setIdx}, 'weight', this.value)">
                                            <span style="color: #9ca3af; font-size: 0.8rem;">kg</span>
                                        ` : ''}
                                        <button class="remove-btn" onclick="app.removeLogSet(${exIdx}, ${setIdx})">√ó</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function addLogSet(exIdx) {
                activeWorkout.exercises[exIdx].sets.push({reps: '', weight: '', completed: false});
                renderLogging();
            }

            function removeLogSet(exIdx, setIdx) {
                activeWorkout.exercises[exIdx].sets.splice(setIdx, 1);
                renderLogging();
            }

            function updateLogSet(exIdx, setIdx, field, value) {
                activeWorkout.exercises[exIdx].sets[setIdx][field] = value;
            }

            function toggleSet(exIdx, setIdx, checked) {
                activeWorkout.exercises[exIdx].sets[setIdx].completed = checked;
            }

            function copyLastWorkout(exIdx) {
                const exercise = activeWorkout.exercises[exIdx];
                const lastWorkout = getLastWorkoutData(exercise.name);
                
                if (!lastWorkout) return;
                
                // Clear existing sets and copy from last workout
                activeWorkout.exercises[exIdx].sets = lastWorkout.sets.map(set => ({
                    reps: set.reps,
                    weight: set.weight,
                    completed: false
                }));
                
                renderLogging();
            }

            function completeWorkout() {
                if (!activeWorkout) return;
                
                const duration = Math.floor((Date.now() - startTime) / 60000);
                const completedExercises = activeWorkout.exercises
                    .map(ex => ({
                        ...ex,
                        sets: ex.sets.filter(s => s.completed).map(s => ({
                            reps: parseInt(s.reps) || 0,
                            weight: parseFloat(s.weight) || 0
                        }))
                    }))
                    .filter(ex => ex.sets.length > 0);
                
                if (completedExercises.length === 0) {
                    alert('Complete at least one set!');
                    return;
                }
                
                history.push({
                    id: Date.now(),
                    workoutId: activeWorkout.id,
                    name: activeWorkout.name,
                    completedAt: new Date().toISOString(),
                    duration,
                    exercises: completedExercises
                });
                
                localStorage.setItem('history', JSON.stringify(history));
                closeModal('loggingModal');
                activeWorkout = null;
                alert(`Workout completed! ${completedExercises.length} exercises logged.`);
            }

            function showProgress(exerciseName) {
                document.getElementById('progressTitle').textContent = `Progress: ${exerciseName}`;
                renderChart(exerciseName);
                document.getElementById('progressModal').classList.add('active');
            }

            function renderChart(exerciseName) {
                const container = document.getElementById('chartContent');
                const logs = [];
                
                history.forEach(w => {
                    const ex = w.exercises.find(e => e.name === exerciseName);
                    if (ex && ex.sets.length > 0) {
                        logs.push({
                            date: new Date(w.completedAt),
                            sets: ex.sets
                        });
                    }
                });
                
                if (logs.length === 0) {
                    container.innerHTML = `
                        <div class="no-data-message">
                            <div class="empty-icon">üìà</div>
                            <h3>No data yet</h3>
                            <p>Complete some workouts to see progress!</p>
                        </div>
                    `;
                    return;
                }
                
                logs.sort((a, b) => a.date - b.date);
                
                const chartData = logs.map(log => ({
                    date: log.date.toLocaleDateString('en-GB', { day: '2-digit', month: 'short' }),
                    weight: Math.max(...log.sets.map(s => s.weight || 0))
                }));
                
                container.innerHTML = `
                    <div class="chart-container">
                        <h3 style="margin-bottom: 15px;">Weight Progression</h3>
                        <canvas id="weightCanvas" class="chart-canvas"></canvas>
                        <div style="text-align: center; margin-top: 15px; color: #9ca3af; font-size: 0.9rem;">
                            Tracking max weight per workout session
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    drawChart('weightCanvas', chartData, 'weight', '#06b6d4');
                }, 100);
            }

            function drawChart(canvasId, data, metric, color) {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const ctx = canvas.getContext('2d');
                const dpr = window.devicePixelRatio || 1;
                const w = canvas.clientWidth || 600;
                const h = canvas.clientHeight || 300;
                
                canvas.width = w * dpr;
                canvas.height = h * dpr;
                ctx.scale(dpr, dpr);
                
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.02)';
                ctx.fillRect(0, 0, w, h);
                
                if (data.length === 0) return;
                
                const padding = { top: 30, right: 30, bottom: 60, left: 60 };
                const chartW = w - padding.left - padding.right;
                const chartH = h - padding.top - padding.bottom;
                
                // Get min and max values
                const values = data.map(d => d[metric]);
                const minValue = Math.min(...values);
                const maxValue = Math.max(...values);
                const range = maxValue - minValue || Math.max(maxValue * 0.1, 5); // Add padding if all values are same
                
                // Add padding to min/max for better visualization
                const paddedMin = minValue - (range * 0.1);
                const paddedMax = maxValue + (range * 0.1);
                const paddedRange = paddedMax - paddedMin;
                
                // Scale functions
                const xScale = (i) => data.length === 1 ? w / 2 : padding.left + (chartW / (data.length - 1)) * i;
                const yScale = (val) => padding.top + chartH - ((val - paddedMin) / paddedRange) * chartH;
                
                // Draw grid lines and Y-axis labels
                const numGridLines = 5;
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.lineWidth = 1;
                ctx.fillStyle = '#9ca3af';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'right';
                
                for (let i = 0; i <= numGridLines; i++) {
                    const value = paddedMin + (paddedRange * i / numGridLines);
                    const y = yScale(value);
                    
                    // Grid line
                    ctx.beginPath();
                    ctx.moveTo(padding.left, y);
                    ctx.lineTo(w - padding.right, y);
                    ctx.stroke();
                    
                    // Y-axis label
                    ctx.fillText(Math.round(value) + ' kg', padding.left - 10, y + 4);
                }
                
                // Draw axes
                ctx.strokeStyle = '#9ca3af';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding.left, padding.top);
                ctx.lineTo(padding.left, h - padding.bottom);
                ctx.lineTo(w - padding.right, h - padding.bottom);
                ctx.stroke();
                
                // Fill area under line with gradient (draw first, behind line)
                if (data.length > 0) {
                    const gradient = ctx.createLinearGradient(0, padding.top, 0, h - padding.bottom);
                    // Convert hex to rgba for gradient
                    const hexToRgba = (hex, alpha) => {
                        const r = parseInt(hex.slice(1, 3), 16);
                        const g = parseInt(hex.slice(3, 5), 16);
                        const b = parseInt(hex.slice(5, 7), 16);
                        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
                    };
                    gradient.addColorStop(0, hexToRgba(color, 0.3));
                    gradient.addColorStop(1, hexToRgba(color, 0.05));
                    
                    ctx.beginPath();
                    ctx.moveTo(xScale(0), h - padding.bottom);
                    data.forEach((item, i) => {
                        const x = xScale(i);
                        const y = yScale(item[metric]);
                        ctx.lineTo(x, y);
                    });
                    ctx.lineTo(xScale(data.length - 1), h - padding.bottom);
                    ctx.closePath();
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
                
                // Draw line (on top of gradient)
                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                data.forEach((item, i) => {
                    const x = xScale(i);
                    const y = yScale(item[metric]);
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
                
                // Draw points and values (on top of everything)
                data.forEach((item, i) => {
                    const x = xScale(i);
                    const y = yScale(item[metric]);
                    
                    // Point circle with white border
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 2;
                    ctx.fillStyle = color;
                    ctx.beginPath();
                    ctx.arc(x, y, 6, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.stroke();
                    
                    // Value label above point
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 12px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText(item[metric] + ' kg', x, y - 12);
                    
                    // Date label below X-axis (rotated)
                    ctx.fillStyle = '#9ca3af';
                    ctx.font = '10px sans-serif';
                    ctx.save();
                    ctx.translate(x, h - padding.bottom + 15);
                    ctx.rotate(-Math.PI / 4);
                    ctx.textAlign = 'right';
                    ctx.fillText(item.date, 0, 0);
                    ctx.restore();
                });
            }

            function displayProgress() {
                const container = document.getElementById('progressContent');
                
                if (history.length === 0) {
                    container.innerHTML = `
                        <div class="no-data-message">
                            <div class="empty-icon">üìà</div>
                            <h3>No workout history yet</h3>
                            <p>Complete some workouts to see your progress!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div style="margin-bottom: 30px;">
                        <h3 style="margin-bottom: 15px;">Recent Workouts</h3>
                        ${history.slice().reverse().slice(0, 10).map(w => `
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-bottom: 10px;">
                                <div style="font-weight: bold; margin-bottom: 5px;">${w.name}</div>
                                <div style="color: #9ca3af; font-size: 0.9rem;">
                                    ${new Date(w.completedAt).toLocaleDateString()} ‚Ä¢ ${w.exercises.length} exercises ‚Ä¢ ${w.duration} min
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }

            function startQuickWorkout() {
                if (workouts.length > 0) {
                    startWorkout(workouts[0].id);
                } else {
                    createWorkout();
                }
            }

            init();

            return {
                showPage,
                createWorkout,
                addExercise,
                addSet,
                removeSet,
                updateSet,
                removeExercise,
                saveWorkout,
                editWorkout,
                deleteWorkout,
                displayWorkouts,
                startWorkout,
                addLogSet,
                removeLogSet,
                updateLogSet,
                toggleSet,
                copyLastWorkout,
                completeWorkout,
                showProgress,
                displayProgress,
                closeModal,
                startQuickWorkout
            };
        })();
    </script>
</body>
</html>
